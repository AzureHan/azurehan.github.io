<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL 笔记 | Azure&#39;s Notebook</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.003d6652.css" as="style"><link rel="preload" href="/assets/js/app.ed19ba6d.js" as="script"><link rel="preload" href="/assets/js/11.d37d9b8b.js" as="script"><link rel="prefetch" href="/assets/js/10.725adfc7.js"><link rel="prefetch" href="/assets/js/12.7381f097.js"><link rel="prefetch" href="/assets/js/13.7bfd8c5c.js"><link rel="prefetch" href="/assets/js/14.0851aedb.js"><link rel="prefetch" href="/assets/js/15.4aa69a87.js"><link rel="prefetch" href="/assets/js/16.e91cefc8.js"><link rel="prefetch" href="/assets/js/17.bf11e506.js"><link rel="prefetch" href="/assets/js/18.cfde5974.js"><link rel="prefetch" href="/assets/js/19.6182ee07.js"><link rel="prefetch" href="/assets/js/2.af91441d.js"><link rel="prefetch" href="/assets/js/20.be8f3590.js"><link rel="prefetch" href="/assets/js/21.0c23aafe.js"><link rel="prefetch" href="/assets/js/22.72f4f18e.js"><link rel="prefetch" href="/assets/js/23.963bec41.js"><link rel="prefetch" href="/assets/js/24.e713fe21.js"><link rel="prefetch" href="/assets/js/25.b1041c73.js"><link rel="prefetch" href="/assets/js/26.db6b8971.js"><link rel="prefetch" href="/assets/js/27.8d89063d.js"><link rel="prefetch" href="/assets/js/28.c52d33c4.js"><link rel="prefetch" href="/assets/js/29.76a01272.js"><link rel="prefetch" href="/assets/js/3.3e582861.js"><link rel="prefetch" href="/assets/js/30.c68724aa.js"><link rel="prefetch" href="/assets/js/31.527e2096.js"><link rel="prefetch" href="/assets/js/32.e1cfa260.js"><link rel="prefetch" href="/assets/js/4.3bfa2392.js"><link rel="prefetch" href="/assets/js/5.1a95e6c3.js"><link rel="prefetch" href="/assets/js/6.aedd08db.js"><link rel="prefetch" href="/assets/js/7.45f2728a.js"><link rel="prefetch" href="/assets/js/8.5fcdd9e7.js"><link rel="prefetch" href="/assets/js/9.778a7fc4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.003d6652.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Azure's Notebook</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Data-Structure</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Network</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>MySQL</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/MySQL/" class="active sidebar-link">MySQL 笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/MySQL/#查询执行过程" class="sidebar-link">查询执行过程</a></li><li class="sidebar-sub-header"><a href="/MySQL/#设计使用技巧" class="sidebar-link">设计使用技巧</a></li><li class="sidebar-sub-header"><a href="/MySQL/#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/MySQL/#解决慢查询-slow-query" class="sidebar-link">解决慢查询 ( slow query )</a></li><li class="sidebar-sub-header"><a href="/MySQL/#数据引擎" class="sidebar-link">数据引擎</a></li><li class="sidebar-sub-header"><a href="/MySQL/#锁机制" class="sidebar-link">锁机制</a></li><li class="sidebar-sub-header"><a href="/MySQL/#尽量避免-null-字段" class="sidebar-link">尽量避免 null 字段</a></li></ul></li><li><a href="/MySQL/Notes-of-High-Performance-MySQL.html" class="sidebar-link">高性能 MySQL ( 第三版 ) 笔记</a></li><li><a href="/MySQL/Replication-and-Partitioning.html" class="sidebar-link">MySQL 主从复制、分区 和 分库分表</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="mysql-笔记"><a href="#mysql-笔记" aria-hidden="true" class="header-anchor">#</a> MySQL 笔记</h1> <h2 id="查询执行过程"><a href="#查询执行过程" aria-hidden="true" class="header-anchor">#</a> 查询执行过程</h2> <ol><li>客户端向 MySQL 服务器发送一条查询请求</li> <li>服务器首先检查查询缓存，如果命中缓存，则立刻返回存储在缓存中的结果，否则进入下一阶段</li> <li>服务器进行 SQL 解析、预处理、再由优化器生成对应的执行计划</li> <li>MySQL 根据执行计划，调用存储引擎的 API 来执行查询</li> <li>将结果返回给客户端，同时缓存查询结果</li></ol> <h2 id="设计使用技巧"><a href="#设计使用技巧" aria-hidden="true" class="header-anchor">#</a> 设计使用技巧</h2> <ul><li>使用合理的字段属性长度</li> <li>使用 <code>ENUM</code> 或 <code>CHAR</code> 而不是 <code>VARCHAR</code></li> <li>尽可能的使用 <code>NOT NULL</code></li> <li>固定长度的表会更快</li> <li>使用 <code>LIMIT</code> 限定行数</li> <li>始终指定你需要的列而不是 <code>SELECT *</code></li> <li>拆分大的 <code>DELETE</code> 或 <code>INSERT</code> 语句</li> <li>使用连接 ( JOIN ) 来代替子查询 ( Sub-Queries )</li> <li>在大数据场景下，表与表之间通过一个冗余字段来关联，要比直接使用 <code>JOIN</code> 有更好的性能</li> <li>多个范围条件无法同时使用多个索引</li></ul> <h2 id="索引"><a href="#索引" aria-hidden="true" class="header-anchor">#</a> 索引</h2> <h3 id="组合索引"><a href="#组合索引" aria-hidden="true" class="header-anchor">#</a> 组合索引</h3> <p>当出现多个列做相交操作时（多个AND条件），通常来说一个包含所有相关列的索引要优于多个独立索引。包含的列遵循最左匹配原则。</p> <h3 id="覆盖索引"><a href="#覆盖索引" aria-hidden="true" class="header-anchor">#</a> 覆盖索引</h3> <p>如果一个索引包含或者说覆盖所有需要查询的字段的值，那么就没有必要再回表查询，可以极大的提高性能。</p> <p>以下是覆盖索引的优点</p> <ul><li>索引条目远小于数据行大小，如果只读取索引，极大减少数据访问量</li> <li>索引是有按照列值顺序存储的，对于 IO 密集型的范围查询要比随机从磁盘读取每一行数据的 IO 要少的多</li></ul> <h3 id="前缀索引"><a href="#前缀索引" aria-hidden="true" class="header-anchor">#</a> 前缀索引</h3> <p>如果字段的类型很长，通常可以索引开始的部分字符，这样可以有效节约索引空间，从而提高索引效率。</p> <h3 id="索引排序"><a href="#索引排序" aria-hidden="true" class="header-anchor">#</a> 索引排序</h3> <p>MySQL 有两种方式可以生产有序的结果集，其一是对结果集进行排序的操作，其二是按照索引顺序扫描得出的结果自然是有序的。如果 EXPLAIN 的结果中 type 列的值为 index 表示使用了索引扫描来做排序。</p> <p>在设计索引时，如果一个索引既能够满足排序，又满足查询，是最好的。</p> <h3 id="聚集索引"><a href="#聚集索引" aria-hidden="true" class="header-anchor">#</a> 聚集索引</h3> <p>聚集索引既存储了索引 , 也存储了行值 . 表数据按照索引的顺序来存储的 , 也就是说索引项的顺序与表中记录的物理顺序一致 . 对于聚集索引 , 叶子结点即存储了真实的数据行 , 不再有另外单独的数据页 .  在一张表上最多只能创建一个聚集索引 , 因为真实数据的物理顺序只能有一种 .</p> <h3 id="主键与唯一索引的区别"><a href="#主键与唯一索引的区别" aria-hidden="true" class="header-anchor">#</a> 主键与唯一索引的区别</h3> <ul><li>主键创建后包含一个唯一性索引</li> <li>主键可以被其他表引用为外键</li> <li>主键是一种约束 , 唯一索引是一种索引 , 两者在本质上是不同的</li> <li>主键列不允许为空值 , 而唯一性索引列允许空值</li> <li>一个表最多只能创建一个主键 , 唯一索引可以创建多个</li></ul> <h2 id="解决慢查询-slow-query"><a href="#解决慢查询-slow-query" aria-hidden="true" class="header-anchor">#</a> 解决慢查询 ( slow query )</h2> <h3 id="慢查询日志"><a href="#慢查询日志" aria-hidden="true" class="header-anchor">#</a> 慢查询日志</h3> <p>在 MySQL 配置文件中找到慢查询日志的文件路径，查询时间大于设置时间的 SQL 将记录到慢查询日志中。</p> <h3 id="explain-分析-sql"><a href="#explain-分析-sql" aria-hidden="true" class="header-anchor">#</a> EXPLAIN 分析 SQL</h3> <p>使用 EXPLAIN 关键字可以模拟优化器执行 SQL 查询语句，从而知道 MySQL 是如何处理 SQL 语句的。这可以帮助分析你的查询语句或是表结构的性能瓶颈。</p> <p>以下信息可以通过 EXPLAIN 命令得到</p> <ul><li><code>id</code> 表的读取顺序</li> <li><code>select_type</code> 数据读取操作的操作类型</li> <li><code>table</code> 对应的数据表名称</li> <li><code>type</code></li> <li><code>possible_keys</code> 哪些索引可以使用</li> <li><code>key</code> 哪些索引被实际使用</li> <li><code>ref</code> 表之间的引用</li> <li><code>rows</code> 每张表有多少行被优化器查询</li> <li><code>extra</code> 使用信息</li></ul> <h2 id="数据引擎"><a href="#数据引擎" aria-hidden="true" class="header-anchor">#</a> 数据引擎</h2> <h3 id="如何选择"><a href="#如何选择" aria-hidden="true" class="header-anchor">#</a> 如何选择</h3> <ol><li>MySQL5.5 版本开始 InnoDB 已经成为 MySQL 的默认引擎( 之前是 MyISAM )，说明其优势是有目共睹的，如果你不知道用什么，那就用 InnoDB，至少不会差</li> <li>是否要支持事务，如果要请选择 InnoDB ，如果不需要可以考虑 MyISAM</li> <li>如果表中绝大多数都只是读查询，可以考虑 MyISAM，如果既有读写也挺频繁，请使用 InnoDB</li></ol> <h3 id="区别"><a href="#区别" aria-hidden="true" class="header-anchor">#</a> 区别</h3> <ol><li>InnoDB 所有的表都保存在同一个数据文件中；MyISAM 将表结构，表索引，表数据分为三个文件储存。</li> <li>InnoDB 支持事务， MyISAM 不支持，对于 InnoDB 每一条SQL语言都默认封装成事务，自动提交，这样会影响速度，所以最好把多条 SQL 语言放在 begin 和 commit 之间，组成一个事务</li> <li>InnoDB 支持外键，而 MyISAM 不支持。对一个包含外键的 InnoDB 表转为 MyISAM 会失败</li> <li>InnoDB 是聚集索引，数据文件是和索引绑在一起的，必须要有主键，通过主键索引效率很高。但是辅助索引需要两次查询，先查询到主键，然后再通过主键查询到数据。因此，主键不应该过大，因为主键太大，其他索引也都会很大。而 MyISAM 是非聚集索引，数据文件是分离的，索引保存的是数据文件的指针。主键索引和辅助索引是独立的</li> <li>InnoDB 不保存表的具体行数，执行 <code>select count(*) from table</code> 时需要全表扫描。而 MyISAM 用一个变量保存了整个表的行数，执行上述语句时只需要读出该变量即可，速度很快</li> <li>InnoDB 支持行级锁，但需要在明确主键的情况下</li></ol> <h2 id="锁机制"><a href="#锁机制" aria-hidden="true" class="header-anchor">#</a> 锁机制</h2> <h2 id="尽量避免-null-字段"><a href="#尽量避免-null-字段" aria-hidden="true" class="header-anchor">#</a> 尽量避免 <code>null</code> 字段</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> users<span class="token punctuation">(</span>name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token string">'Alice'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token string">'Barbie'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token string">'Christiana'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token string">'Donna'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token string">'Eliza'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token string">'Frances'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token string">'Greer'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> name <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'Christiana'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> name <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token string">'Christiana'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> name <span class="token operator">!=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span> 
<span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> name <span class="token operator">!=</span> <span class="token string">'Christiana'</span><span class="token punctuation">;</span> 

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> vip<span class="token punctuation">(</span>name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> vip <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token string">'Christiana'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> vip <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token boolean">NULL</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> users <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> NAME_IDX<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> vip <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> NAME_IDX<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Christiana'</span><span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vip <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Christiana'</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/PHP/Install-Laravel-echo-server.html" class="prev">
          安装 Laravel-echo-server
        </a></span> <span class="next"><a href="/MySQL/Notes-of-High-Performance-MySQL.html">
          高性能 MySQL ( 第三版 ) 笔记
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/11.d37d9b8b.js" defer></script><script src="/assets/js/app.ed19ba6d.js" defer></script>
  </body>
</html>
